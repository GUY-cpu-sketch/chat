<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StartMyEducation - Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1, h2 { color: #333; }
    .container { max-width: 900px; margin: auto; }
    #userList, #whisperLogs { border: 1px solid #ccc; background: #fff; padding: 10px; margin-bottom: 20px; max-height: 300px; overflow-y: auto; }
    .command { margin-bottom: 10px; }
    input { padding: 5px; margin-right: 5px; }
    button { padding: 5px 10px; cursor: pointer; }
    label { font-weight: bold; margin-right: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin Panel</h1>

    <h2>Online Users</h2>
    <ul id="userList"></ul>

    <h2>Whisper Logs</h2>
    <div id="whisperLogs"></div>

    <h2>Admin Commands</h2>
    <div class="command">
      <label>Username:</label>
      <input id="targetUser" placeholder="Enter username"/>
      <button id="kickBtn">Kick</button>
      <button id="banBtn">Ban</button>
      <button id="muteBtn">Mute (sec)</button>
      <input id="muteTime" type="number" placeholder="Time in seconds" style="width: 80px;"/>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const userList = document.getElementById("userList");
    const whisperLogs = document.getElementById("whisperLogs");

    const targetUser = document.getElementById("targetUser");
    const kickBtn = document.getElementById("kickBtn");
    const banBtn = document.getElementById("banBtn");
    const muteBtn = document.getElementById("muteBtn");
    const muteTime = document.getElementById("muteTime");

    // auto-login as admin
    const adminUsername = 'DEV';
    socket.emit('login', { username: adminUsername });

    // update online users
    socket.on("updateUsers", (list) => {
      userList.innerHTML = list.map(u => `<li>${u}</li>`).join("");
    });

    // update whispers
    socket.on("updateWhispers", (all) => {
      whisperLogs.innerHTML = "";
      all.forEach((w) => {
        const time = new Date(w.time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const p = document.createElement('p');
        p.innerHTML = `<span style="color:#aaa">[${time}]</span> <b>${w.from}</b> â†’ <b>${w.to}</b>: ${w.message}`;
        whisperLogs.appendChild(p);
      });
    });

    // admin commands
    kickBtn.addEventListener("click", () => {
      const target = targetUser.value.trim();
      if (!target) return alert("Enter a username!");
      socket.emit("adminCommand", { cmd: 'kick', target });
    });

    banBtn.addEventListener("click", () => {
      const target = targetUser.value.trim();
      if (!target) return alert("Enter a username!");
      socket.emit("adminCommand", { cmd: 'ban', target });
    });

    muteBtn.addEventListener("click", () => {
      const target = targetUser.value.trim();
      const time = muteTime.value || 60;
      if (!target) return alert("Enter a username!");
      socket.emit("adminCommand", { cmd: 'mute', target, arg: time });
    });

    // system messages
    socket.on("system", (msg) => console.log("[SYSTEM]", msg));
  </script>
</body>
</html>
